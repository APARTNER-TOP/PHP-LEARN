<!DOCTYPE html>
<html lang="uk">

<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>PHP Електронна пошта налаштуванння і відправка листів</title>
   <link rel="stylesheet" href="assets/css/style.css">

   <!-- hightlight -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">

   <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
   <!-- and it's easy to individually load additional languages -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js"></script>

   <link rel="stylesheet" href="assets/css/codeHightLight.css">
</head>

<body>
   <div class="post-content">
      <h2>Урок: Відправка електронних повідомлень з використанням PHP</h2>

      Відправка електронних листів є важливою функцією веб-додатків. За допомогою PHP ви можете легко налаштувати
      відправку електронних повідомлень з вашого веб-сайту. У цьому уроці ми розглянемо процес відправки електронної
      пошти з використанням PHP та надамо детальні пояснення та приклади коду.<br>

      Крок 1: Налаштування параметрів електронної пошти<br>
      Перш ніж почати відправку електронних повідомлень, потрібно налаштувати параметри електронної пошти, такі як
      адреса відправника, адреса отримувача, тема повідомлення і тіло повідомлення. Ось приклад коду, який налаштовує ці
      параметри:<br>

      <pre>
         <code>
            $to = 'recipient@example.com'; // Адреса отримувача
            $subject = 'Привіт, це тема повідомлення'; // Тема повідомлення
            $message = 'Привіт! Це текст повідомлення.'; // Тіло повідомлення

            $headers = "From: sender@example.com\r\n"; // Адреса відправника

            // Додаткові заголовки
            $headers .= "Reply-To: sender@example.com\r\n";
            $headers .= "CC: copy@example.com\r\n";
            $headers .= "BCC: hidden@example.com\r\n";
         </code>
      </pre>

      У цьому прикладі ми встановлюємо адресу отримувача ($to), тему повідомлення ($subject), текст повідомлення
      ($message) і адресу відправника ($headers). Також ми можемо додати додаткові заголовки, які вказують на адреси для
      відповіді, копіювання або приховану копіювання.<br>

      Заголовки електронної пошти дозволяють додатково налаштувати параметри відправлення повідомлення. Ось розшифровка
      додаткових заголовків, які вказані у ваших прикладах:<br>
      Reply-To: Цей заголовок вказує на адресу, на яку повинна бути відправлена відповідь на повідомлення. Якщо
      отримувач натисне кнопку "Відповісти" у своєму електронному клієнті, адреса, вказана в цьому заголовку, буде
      використовуватись як адреса для відправлення відповіді.<br>

      CC (Carbon Copy): Цей заголовок дозволяє вам вказати адреси, на які буде надіслана копія повідомлення. Всі
      отримувачі, перераховані у полі "CC", будуть бачити, кому була відправлена копія повідомлення.<br>

      BCC (Blind Carbon Copy): Цей заголовок працює аналогічно до заголовка "CC", але з однією важливою відмінністю.
      Адреси, перераховані у полі "BCC", не будуть видимі для інших отримувачів. Це дозволяє вам надсилати копії
      повідомлення іншим отримувачам анонімно.<br>

      Наприклад, якщо ви хочете налаштувати електронне повідомлення з додатковими заголовками, ось як це можна зробити:

      <pre>
         <code>
            $headers .= "Reply-To: sender@example.com\r\n";
            $headers .= "CC: copy@example.com\r\n";
            $headers .= "BCC: hidden@example.com\r\n";
         </code>
      </pre>

      У цьому прикладі ми додаємо додаткові заголовки до змінної $headers. Заголовок "Reply-To" вказує на адресу, на яку
      повинна бути відправлена відповідь. Заголовок "CC" вказує адресу або адреси для копіювання повідомлення. Заголовок
      "BCC" вказує адресу або адреси для прихованого копіювання повідомлення.<br>
      За допомогою цих додаткових заголовків ви можете налаштувати більш гнучке керування електронними листами і вказати
      адреси для відповіді та копіювання/прихованого копіювання повідомлення за потреби.<br>

      Крок 2: Відправлення електронного повідомлення<br>
      Після налаштування параметрів електронної пошти ми можемо перейти до фактичної відправки повідомлення. У PHP для
      цього використовується функція mail(). Ось приклад коду, який відправляє електронне повідомлення:

      <pre>
         <code>
            if (mail($to, $subject, $message, $headers)) {
               echo 'Повідомлення успішно відправлено.';
            } else {
               echo 'Помилка при відправленні повідомлення.';
            }
         </code>
      </pre>

      У цьому прикладі ми використовуємо функцію mail() з встановленими параметрами електронної пошти. Функція mail()
      повертає true, якщо повідомлення було успішно відправлено, і false, якщо сталася помилка.<br>

      Крок 3: Перевірка налаштувань сервера<br>
      Перед використанням функції mail() у вас повинні бути налаштовані параметри електронної пошти на сервері.
      Зв'яжіться з вашим хостинг-провайдером або адміністратором сервера, щоб переконатися, що вони налаштували
      правильні параметри електронної пошти.<br>

      Додаткові поради:<br>
      Переконайтеся, що ваш сервер має правильні налаштування для відправки електронної пошти. Деякі сервери можуть
      вимагати додаткові налаштування або аутентифікацію.<br>
      Важливо бути обережним при використанні введених користувачем даних в параметрах електронної пошти, щоб уникнути
      вразливостей безпеки. Завжди перевіряйте та очищуйте дані, які ви використовуєте в електронних листах.<br>
      Це основний процес відправки електронних повідомлень з використанням PHP. Ви можете налаштувати і додати додаткові
      параметри або функціональність відповідно до ваших потреб.<br><br>

      Також можна надсилати вкладені файли за допомогою php<br>
      Щоб додати можливість надсилання вкладених файлів, таких як зображення або архіви, вам потрібно використовувати
      функції та методи, що забезпечують завантаження файлів на сервер та їх прикріплення до електронного повідомлення.
      Ось детальний опис процесу з прикладами коду:<br>
      Крок 1: HTML форма для вибору файлу
      Створіть HTML форму, де користувачі зможуть вибрати файли для завантаження. Додайте атрибут
      enctype="multipart/form-data" до вашої форми, щоб забезпечити коректну передачу файлів. Ось приклад коду HTML
      форми:<br>
      <pre>
         <code>
            < form action="upload.php" method="POST" enctype="multipart/form-data">
               < input type="file" name="fileToUpload">
               < input type="submit" value="Upload">
            < / form>
         </code>
      </pre>
      Крок 2: Обробка завантаженого файлу<br>
      Створіть PHP скрипт, який оброблюватиме завантажений файл. Використовуйте глобальну змінну $_FILES, щоб отримати
      доступ до інформації про завантажений файл. Ось приклад коду PHP для обробки завантаженого файлу:

      <pre>
         <code>
            $targetDir = "uploads/"; // Директорія для збереження завантажених файлів
            $targetFile = $targetDir . basename($_FILES["fileToUpload"]["name"]); // Шлях до завантаженого файлу

            if (move_uploaded_file($_FILES["fileToUpload"]["tmp_name"], $targetFile)) {
               echo "Файл успішно завантажено.";
            } else {
               echo "Помилка при завантаженні файлу.";
            }
         </code>
      </pre>

      У цьому прикладі ми визначаємо директорію, куди будуть збережені завантажені файли ($targetDir). Використовуємо
      move_uploaded_file() для переміщення завантаженого файлу з тимчасового розташування
      ($_FILES["fileToUpload"]["tmp_name"]) до цільової директорії.<br><br>
      Крок 3: Прикріплення файлу до електронного повідомлення
      Для прикріплення файлу до електронного повідомлення використовуйте бібліотеку PHPMailer або SwiftMailer. Вони
      надають зручний спосіб надсилання електронних повідомлень з вкладеними файлами. Ось приклад використання
      PHPMailer:<br>

      <pre>
         <code>
            use PHPMailer\PHPMailer\PHPMailer;
            use PHPMailer\PHPMailer\Exception;

            require 'vendor/autoload.php'; // Підключення PHPMailer

            // Створення об'єкту PHPMailer
            $mail = new PHPMailer(true);

            try {
               $mail->isSMTP();
               $mail->Host = 'smtp.example.com'; // Адреса SMTP сервера
               $mail->SMTPAuth = true;
               $mail->Username = 'your_email@example.com'; // Ваша адреса електронної пошти
               $mail->Password = 'your_email_password'; // Пароль від вашої адреси електронної пошти
               $mail->SMTPSecure = 'tls';
               $mail->Port = 587;

               $mail->setFrom('from@example.com', 'Your Name'); // Адреса та ім'я відправника
               $mail->addAddress('recipient@example.com', 'Recipient Name'); // Адреса та ім'я отримувача
               $mail->addReplyTo('replyto@example.com', 'Reply-To Name'); // Адреса та ім'я для відповіді

               $mail->Subject = 'Тема листа';
               $mail->Body = 'Текст повідомлення';

               $attachmentPath = 'uploads/filename.ext'; // Шлях до завантаженого файлу
               $mail->addAttachment($attachmentPath); // Прикріплення файлу до повідомлення

               $mail->send();
               echo 'Повідомлення успішно відправлено.';
            } catch (Exception $e) {
               echo 'Помилка при відправленні повідомлення: ' . $mail->ErrorInfo;
            }
         </code>
      </pre>

      У цьому прикладі ми використовуємо PHPMailer для створення об'єкту PHPMailer. Встановлюємо параметри SMTP сервера,
      аутентифікації, адресу та ім'я відправника, отримувача та ім'я для відповіді. Додаємо тему та текст повідомлення.
      За допомогою $mail->addAttachment() додаємо завантажений файл до повідомлення.<br>
      Не забудьте встановити бібліотеку PHPMailer, що надається як пакет Composer. Установку бібліотеки та налаштування
      можна знайти в документації PHPMailer.<br>
      З цими кроками ви зможете додати можливість надсилання вкладених файлів зображень або архівів у своїх електронних
      повідомленнях.<br>

      Якщо ви не хочете використовувати сторонні бібліотеки, такі як PHPMailer, ви можете використовувати вбудовані
      функції PHP для відправки електронних повідомлень з вкладеними файлами. Ось приклад, як це можна зробити:<br>

      <pre>
         <code>
            $to = 'recipient@example.com'; // Адреса отримувача
            $from = 'from@example.com'; // Адреса відправника
            $subject = 'Тема листа';
            $message = 'Текст повідомлення';

            // Генеруємо унікальний рядок для імені файлу
            $filename = md5(uniqid());

            // Шлях до файлу, який ви хочете прикріпити
            $file_path = 'path/to/your/file.jpg';

            // Встановлюємо заголовки для електронної пошти
            $headers = "From: $from\r\n";
            $headers .= "Reply-To: $from\r\n";
            $headers .= "MIME-Version: 1.0\r\n";
            $headers .= "Content-Type: multipart/mixed; boundary=\"boundary\"\r\n";

            // Створюємо повідомлення
            $body = "--boundary\r\n";
            $body .= "Content-Type: text/plain; charset=utf-8\r\n";
            $body .= "Content-Transfer-Encoding: 7bit\r\n";
            $body .= "\r\n";
            $body .= $message . "\r\n";
            $body .= "--boundary\r\n";

            // Додаємо вкладений файл
            $file = file_get_contents($file_path);
            $body .= "Content-Type: application/octet-stream; name=\"$filename\"\r\n";
            $body .= "Content-Transfer-Encoding: base64\r\n";
            $body .= "Content-Disposition: attachment; filename=\"$filename\"\r\n";
            $body .= "\r\n";
            $body .= chunk_split(base64_encode($file));
            $body .= "--boundary--";

            // Відправляємо електронне повідомлення
            if (mail($to, $subject, $body, $headers)) {
               echo 'Повідомлення успішно відправлено.';
            } else {
               echo 'Помилка при відправленні повідомлення.';
            }
         </code>
      </pre>

      У цьому прикладі ми використовуємо функцію mail() для відправки електронного повідомлення. Встановлюємо відповідні
      заголовки, включаючи заголовок Content-Type для повідомлення з вкладеним файлом. Створюємо повідомлення з
      текстовою частиною і вкладеним файлом. Потім викликаємо функцію mail() з необхідними параметрами.<br>

      Важливо зауважити, що використання вбудованої функції mail() має свої обмеження, і результати можуть варіюватись
      залежно від конфігурації вашого сервера. Деякі сервери можуть обмежувати можливість відправки вкладених файлів або
      можуть вимагати додаткової конфігурації.

      <br>

      Щоб налаштувати локальний сервер для відправки повідомлень через Google або Mailgun, вам знадобиться налаштувати
      SMTP-клієнт для взаємодії зі службами цих провайдерів. Ось опис процесу для кожного провайдера:<br>
      Google: Якщо ви хочете використовувати Gmail для відправки повідомлень, вам потрібно налаштувати SMTP-клієнт з
      використанням наступних налаштувань:

      SMTP-сервер: smtp.gmail.com<br>
      Порт: 587<br>
      Ім'я користувача: ваша адреса електронної пошти Gmail (наприклад, example@gmail.com)<br>
      Пароль: пароль від вашої адреси електронної пошти<br>
      Ви можете використовувати сторонню бібліотеку, таку як PHPMailer або SwiftMailer, які надають спрощений спосіб
      взаємодії з SMTP-сервером Google. Потрібно встановити бібліотеку, налаштувати параметри підключення і використати
      її для відправлення електронних повідомлень через Gmail.<br><br>

      Mailgun: Якщо ви хочете використовувати Mailgun для відправки повідомлень, вам потрібно налаштувати SMTP-клієнт з
      використанням наступних налаштувань:<br>
      <br>
      SMTP-сервер: smtp.mailgun.org<br>
      Порт: 587<br>
      Ім'я користувача: SMTP-логін вашого домену Mailgun<br>
      Пароль: SMTP-пароль вашого домену Mailgun<br>
      Ви також можете використовувати сторонню бібліотеку, таку як PHPMailer або SwiftMailer, які надають спрощений
      спосіб взаємодії з SMTP-сервером Mailgun. Встановіть бібліотеку, налаштуйте параметри підключення і використовуйте
      її для відправлення електронних повідомлень через Mailgun.<br>
      <br>
      Незалежно від провайдера, вам знадобиться встановлення та налаштування бібліотеки або клієнта SMTP для взаємодії з
      відповідними серверами. Кожен провайдер може мати свої власні документації та рекомендації, як правильно
      налаштувати відправку повідомлень.<br>
      <br>
      Будь ласка, зверніться до документації Google або Mailgun для отримання більш детальних інструкцій та прикладів
      налаштування.<br>

   </div>
   <div class="task">
      <br>
      Завдання:<br>
      1) Повторити пройдений матеріал<br>
      <br>
      <br>
   </div>

   <script src="assets/js/app.js"></script>
</body>

</html>