<!DOCTYPE html>
<html lang="uk">

<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>PHP Робота з файловою системою</title>
   <link rel="stylesheet" href="assets/css/style.css">

   <!-- hightlight -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">

   <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
   <!-- and it's easy to individually load additional languages -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js"></script>

   <link rel="stylesheet" href="assets/css/codeHightLight.css">
</head>

<body>
   <div class="post-content">

      <h2>PHP Робота з файловою системою</h2>

      Як і більшість мов програмування, PHP підтримує роботу з файлами, які є одним із способів зберігання
      інформації.<br>
      <h2>Читання та запис файлів</h2>
      <h2>Відкриття та закриття файлів</h2>


      Для відкриття файлів у PHP визначено функцію fopen() . Вона має таке визначення:

      <pre>
         <code>
            fopen(

               string $filename,

               string $mode,

               bool $use_include_path = false,

               ?resource $context = null

            ) : resource | false 
         </code>
      </pre>

      string $filename – шлях до файлу,<br>

      string $mode – режим відкриття. Залежно від мети відкриття та типу файлу, цей параметр може приймати наступні
      значення:<br><br>

      'r' – файл відкривається лише для читання. Якщо файл не існує, повертає false .<br>
      'r+' – файл відкривається лише для читання з можливістю запису. Якщо файл не існує, повертає false .<br>
      'w' – файл відкривається для запису. Якщо такий файл вже існує, він перезаписується, якщо ні – він
      створюється.<br>
      'w+' – файл відкривається для запису з можливістю читання. Якщо такий файл вже існує, він перезаписується, якщо ні
      – він створюється.<br>
      'a' – файл відкривається для запису. Якщо такий файл вже існує, дані записуються в кінець файлу, а старі дані
      залишаються. Якщо файл не існує, він створюється.<br>
      'a+' – файл відкривається для читання та запису. Якщо файл вже існує, дані дозаписуються в кінець файлу. Якщо
      файлу немає, він створюється.<br>
      Результатом функції fopen буде дескриптор файлу. Цей дескриптор використовується для операцій із файлом та для
      його закриття.<br>
      <br>
      Після закінчення роботи файл слід закрити за допомогою функції fclose() , яка приймає як параметр дескриптор
      файлу.<br><br>

      Наприклад, відкриємо та закриємо файл:<br>

      <pre>
         <code>
            $fd= fopen( "form.php", 'r') ordie( "не вдалося відкрити файл");
            fclose( $fd);
         </code>
      </pre>

      Конструкція or die("текст помилки") дозволяє припинити роботу скрипту та вивести деяке повідомлення про помилку,
      якщо функція fopen не змогла відкрити файл.

      <br>
      <h2>Читання файлу</h2>
      Для читання файлу можна скористатися кількома функціями. Для рядкового читання використовується функція fgets()
      <pre>
         <code>
            fgets(

               resource $stream, 

               ?int $length = null

               ) : string | false
         </code>
      </pre>

      яка отримує дескриптор файлу та повертає один рядок. Пройдемо рядково по всьому файлу:

      <pre>
         <code>
            $fd = fopen( "form.php", 'r' ) or die( "не вдалося відкрити файл" );
            while( !feof( $fd ) ) {
               $str = htmlentities( fgets( $fd ) );
               echo $str;
            }
            
            fclose( $fd );
         </code>
      </pre>

      При кожному виклику fgets() PHP поміщатиме покажчик у кінець ліченого рядка. Щоб простежити закінчення файлу,
      використовується функція feof() ,

      <pre>
         <code>
            feof(

               resource $stream

               ) : bool
         </code>
      </pre>

      яка повертається true після завершення файлу. І поки не буде досягнуто кінця файлу, ми можемо застосовувати
      функцію fgets().<br>

      <h2>Читання файлу повністю</h2>

      Якщо нам треба прочитати файл повністю, ми можемо полегшити собі життя, застосувавши функцію file_get_contents() :

      <pre>
         <code>
            file_get_contents(
               string $filename,
               bool $use_include_path = false,
               ?resource $context = null,
               int $offset = 0,
               ?int $length = null
            ) : string | false
         </code>
      </pre>

      <pre>
         <code>
            $str = htmlentities( file_get_contents( "form.php" ) );
            echo $str;
         </code>
      </pre>

      При цьому нам не треба відкривати файл, отримувати дескриптор, а потім закривати файл.<br>

      <h2>Поблочне зчитування</h2>
      Також можна провести поблочне зчитування, тобто зчитувати певну кількість байт із файлу за допомогою функції
      fread() :

      <pre>
         <code>
            $fd = fopen( "form.php", 'r' ) or die( "не вдалося відкрити файл" );
            while ( ! feof( $fd ) ) {
               $str = htmlentities( fread( $fd, 600 ) );
               echo $str;
            }

            fclose( $fd );
         </code>
      </pre>

      Функція fread() приймає два параметри: дескриптор зчитуваного файлу та кількість байтів, що зчитуються. При
      зчитуванні блоку покажчик у файлі стає на кінець цього блоку. Також за допомогою функції feof() можна відстежити
      завершення файлу.<br><br>

      <h2>Запис файлу</h2>
      Для запису файлу використовується функція fwrite() , яка записує у файл рядок:

      <pre>
         <code>
            $fd  = fopen( "hello.txt", 'w' ) or die( "не вдалося відкрити файл" );
            $str = "Привіт світ";
            fwrite( $fd, $str );
            fclose( $fd );
         </code>
      </pre>

      Аналогічно працює інша функція fputs() :

      <pre>
         <code>
            $fd  = fopen( "hello.txt", 'w' ) or die( "не вдалося відкрити файл" );
            $str = "Привіт світ";
            fputs( $fd, $str );
            fclose( $fd );
         </code>
      </pre>

      <h2>Робота з покажчиком файлу</h2>

      При відкритті файлу для читання або запису в режимі w, вказівник у файлі поміщається на початок. При зчитуванні
      даних PHP переміщає покажчик у файлі на кінець блоку лічених даних. Однак ми також вручну можемо керувати
      покажчиком у файлі та встановлювати його у довільне місце. Для цього треба використовувати функцію fseek() , яка
      має таке формальне визначення:

      <pre>
         <code>
            fseek(

               resource $stream, 

               int $offset, 

               int $whence = SEEK_SET

               ) : int
         </code>
      </pre>

      $stream представляє дескриптор файлу. <br>

      $offset – зміщення в байтах щодо початку файлу, з якого розпочнеться зчитування/запис. <br>

      $whence – необов’язковий параметр задає спосіб встановлення зміщення. Він може приймати три значення:<br>

      SEEK_SET : значення за замовчуванням, встановлює зміщення в offset байт щодо початку файлу<br>
      SEEK_CUR : встановлює зміщення в offset байт щодо початку поточної позиції у файлі<br>
      SEEK_END : встановлює зміщення в offset байт від кінця файлу<br>


      Повертає 0, а за невдалої установки повертає -1.

      Приклад використання функції:
      <pre>
         <code>
            $fd = fopen( "hello.txt", 'w+' ) or die( "не вдалося відкрити файл" );
            $str = "Привіт світ"; // рядок для запису
            fwrite( $fd, $str ); // запишемо рядок на початок
            fseek( $fd, 0 ); // помістимо покажчик файлу на початок
            fwrite( $fd, "Test" ); // запишемо на початок рядок
            fseek( $fd, 0, SEEK_END ); // помістимо покажчик у кінець
            fwrite( $fd, $str ); // запишемо наприкінці ще один рядок
            fclose( $fd );
         </code>
      </pre>


      Надіюся, що цей урок був корисним для вас, і ви зможете успішно працювати з файловою системою у своїх
      PHP-проектах.
      Успіхів вам у навчанні!
      <br><br>


   </div>
   <div class="task">
      <br>
      Завдання:<br>
      1) Повторити пройдений матеріал<br>
      <br>
      <br>
   </div>

   <script src="assets/js/app.js"></script>
</body>

</html>